<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cat Food Calculator</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #f1f8e9);
      color: #333;
      display: flex;
      justify-content: center;
      align-items: start;
      min-height: 100vh;
      margin: 0;
      padding: 1rem;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      padding: 2rem;
      width: 100%;
      max-width: 600px;
      position: relative;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
      color: #00796b;
      text-align: center;
    }

    .settings-icon {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 1.4rem;
      cursor: pointer;
      color: #00796b;
      transition: color 0.2s ease;
    }

    .settings-icon:hover {
      color: #004d40;
    }

    .cat-section {
      background: #f9fbe7;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .cat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .cat-name {
      font-weight: 600;
      color: #004d40;
      font-size: 1.2rem;
      cursor: pointer;
    }

    .cat-name:hover {
      text-decoration: underline;
    }

    label {
      display: block;
      font-weight: 600;
      margin-top: 0.8rem;
    }

    input, select {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.3rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }

    .daily-input {
      width: 80px;
      padding: 0.3rem;
      border-radius: 6px;
      border: 1px solid #aaa;
      text-align: center;
    }

    .treat-counter {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-top: 1rem;
      padding: 0.5rem 0;
      background: #f1f8e9;
      border-radius: 8px;
    }

    .treat-btn {
      background: #8bc34a;
      color: white;
      border: none;
      width: 36px;
      height: 36px;
      font-size: 1.2rem;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .treat-btn:hover {
      background: #689f38;
    }

    .treat-count {
      font-size: 1.1rem;
      font-weight: 600;
      color: #004d40;
      width: 40px;
      text-align: center;
    }

    .results {
      margin-top: 1rem;
      background: #e0f2f1;
      padding: 0.8rem;
      border-radius: 8px;
      font-size: 0.95rem;
    }

    .reset-btn {
      background: #b71c1c;
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      display: block;
      width: 100%;
      cursor: pointer;
    }

    .reset-btn:hover {
      background: #7f0000;
    }

    /* Settings modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 10;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
      background-color: #ffffff;
      margin: 10% auto;
      padding: 20px;
      border: none;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }

    .modal-content h2 {
      margin-top: 0;
      color: #004d40;
    }

    .close-btn {
      float: right;
      font-size: 1.5rem;
      cursor: pointer;
      color: #00796b;
    }

    .close-btn:hover {
      color: #004d40;
    }

    .modal input {
      width: 100%;
      padding: 0.4rem;
      margin-top: 0.3rem;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    .save-settings {
      background: #00796b;
      color: white;
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 8px;
      width: 100%;
      margin-top: 1rem;
      cursor: pointer;
    }

    .save-settings:hover {
      background: #004d40;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="settings-icon" onclick="openSettings()">‚öôÔ∏è</div>
    <h1>Cat Food Calculator</h1>
    <p style="text-align:center;">Auto-calculates dry food per meal after wet food and treats.</p>

    <!-- Fergus -->
    <div class="cat-section" id="fergus-section">
      <div class="cat-header">
        <div class="cat-name" id="fergusName" onclick="editDailyCals('Fergus')">üêæ Fergus</div>
        <div id="fergusCalInfo" class="small-muted">235 kcal/day</div>
      </div>

      <label>Morning wet food:</label>
      <select id="fergusMorningSelect"></select>
      <input type="number" id="fergusMorningWet" placeholder="Or enter calories manually" />

      <label>Evening wet food:</label>
      <select id="fergusEveningSelect"></select>
      <input type="number" id="fergusEveningWet" placeholder="Or enter calories manually" />

      <div class="treat-counter">
        <button class="treat-btn" onclick="adjustTreats('Fergus', -1)">‚Äì</button>
        <div class="treat-count" id="fergusTreats">0</div>
        <button class="treat-btn" onclick="adjustTreats('Fergus', 1)">+</button>
      </div>

      <div id="fergusResult" class="results"></div>
    </div>

    <!-- Finn -->
    <div class="cat-section" id="finn-section">
      <div class="cat-header">
        <div class="cat-name" id="finnName" onclick="editDailyCals('Finn')">üêæ Finn</div>
        <div id="finnCalInfo" class="small-muted">260 kcal/day</div>
      </div>

      <label>Morning wet food:</label>
      <select id="finnMorningSelect"></select>
      <input type="number" id="finnMorningWet" placeholder="Or enter calories manually" />

      <label>Evening wet food:</label>
      <select id="finnEveningSelect"></select>
      <input type="number" id="finnEveningWet" placeholder="Or enter calories manually" />

      <div class="treat-counter">
        <button class="treat-btn" onclick="adjustTreats('Finn', -1)">‚Äì</button>
        <div class="treat-count" id="finnTreats">0</div>
        <button class="treat-btn" onclick="adjustTreats('Finn', 1)">+</button>
      </div>

      <div id="finnResult" class="results"></div>
    </div>

  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeSettings()">&times;</span>
      <h2>Settings ‚öôÔ∏è</h2>
      <label>Calories per gram of dry food:</label>
      <input type="number" id="dryCalPerGramInput" step="0.1" />

      <label>Calories per treat:</label>
      <input type="number" id="treatCaloriesInput" step="0.1" />

      <button class="save-settings" onclick="saveSettings()">Save Settings</button>
    </div>
  </div>
<script>
  let dryCalPerGram = 4.1;
  let treatCalories = 2;

  const wetFoods = [    
  { name: "Press Your Lunch (10oz)", servingsCount: 4, cals: 189 },
      { name: "Press Your Lunch (5.5oz)", servingsCount: 2, cals: 103 },
      { name: "Topsie Turvy (5.5oz)", servingsCount: 2, cals: 168 },
      { name: "Selfie Cam (5.5oz)", servingsCount: 2, cals: 133 },
      { name: "QT Patootie (5.5oz)", servingsCount: 2, cals: 107 },
      { name: "Meal or No Deal (5.5oz)", servingsCount: 2, cals: 93 },
	  { name: "Meal or No Deal (10oz)", servingsCount: 4, cals: 170 },
	  { name: "The Double Dip (5.5oz)", servingsCount: 2, cals:111 },
	  { name: "Meows n' Holler Purramid (5.5oz)", servingsCount: 2, cals: 114 },
	  { name: "Soulistic - Chicken n Turkey Pate (5.5oz)", servingsCount: 2, cals: 168 },
	  { name: "Press Your Dinner (5.5oz)", servingsCount: 2, cals: 170 },
	  { name: "Funk in the Trunk (5.5oz)", servingsCount: 2, cals: 102 },
	  { name: "Splash Dance (5.5oz)", servingsCount: 2, cals: 146 },
	  { name: "Chicken Frick a Zee (5.5oz)", servingsCount: 2, cals: 142 },
	  { name: "Fowl Ball (5.5oz)", servingsCount: 2, cals: 129 },
	  { name: "Lamb Burgini (5.5oz)", servingsCount: 2, cals: 147 },
	  { name: "Quick n Quirky (5.5oz)", servingsCount: 2, cals: 103 },
	  { name: "Steak Frites (5.5oz)", servingsCount: 2, cals: 124 },
	  { name: "Peking Ducken (5.5oz)", servingsCount: 2, cals: 112 },
	  { name: "Grandma's Chicken Soup (5.5oz)", servingsCount: 2, cals: 106 },
	  { name: "BFF OMG Dilly Dally (5.5oz)", servingsCount: 2, cals: 114 },
	  { name: "BFF OMG Cloud 9 (5.5oz)", servingsCount: 2, cals: 197 },
	  { name: "Paw Lickin CHicken (5.5oz)", servingsCount: 2, cals: 105 },
	  { name: "Amazon Livin (5.5oz)", servingsCount: 2, cals: 109 },
  ];

  let cats = {
    Fergus: { daily: 235, treats: 0 },
    Finn: { daily: 260, treats: 0 }
  };

  window.onload = function() {
    loadData();
    populateSelects();
    restoreInputs();
    attachListeners();
    updateTreatDisplays();
    calculateAll();
  };

  function populateSelects() {
    ['Fergus', 'Finn'].forEach(cat => {
      ['Morning', 'Evening'].forEach(time => {
        const select = document.getElementById(`${cat.toLowerCase()}${time}Select`);
        select.innerHTML = '<option value="">-- Select a wet food --</option>';
        wetFoods.forEach(food => {
          const option = document.createElement('option');
          option.value = food.name;
          option.textContent = `${food.name} (${food.cals} cal / ${food.servingsCount} servings)`;
          select.appendChild(option);
        });
        // üîß Add event listener to update input + recalc on selection
        select.addEventListener('change', () => updateWetCalories(cat, time));
      });
    });
  }

  function attachListeners() {
    document.querySelectorAll('input').forEach(el => {
      el.addEventListener('input', () => { saveData(); calculateAll(); });
    });
  }

  // üîß Fix: when selecting a wet food, update input and recalc
  function updateWetCalories(cat, time) {
    const select = document.getElementById(`${cat.toLowerCase()}${time}Select`);
    const input = document.getElementById(`${cat.toLowerCase()}${time}Wet`);
    const food = wetFoods.find(f => f.name === select.value);
    if (food) {
      input.value = (food.cals / food.servingsCount).toFixed(1);
    } else {
      input.value = '';
    }
    saveData();
    calculateAll();
  }

  function adjustTreats(cat, change) {
    cats[cat].treats = Math.max(0, (cats[cat].treats || 0) + change);
    updateTreatDisplays();
    saveData();
    calculateAll();
  }

  function updateTreatDisplays() {
    for (const cat of Object.keys(cats)) {
      const el = document.getElementById(`${cat.toLowerCase()}Treats`);
      if (el) el.textContent = cats[cat].treats;
    }
  }

  function editDailyCals(cat) {
    const div = document.getElementById(`${cat.toLowerCase()}CalInfo`);
    const input = document.createElement('input');
    input.type = 'number';
    input.value = cats[cat].daily;
    input.className = 'daily-input';
    input.addEventListener('blur', () => {
      const val = parseFloat(input.value);
      if (!isNaN(val) && val > 0) cats[cat].daily = val;
      div.textContent = `${cats[cat].daily} kcal/day`;
      saveData();
      calculateAll();
    });
    input.addEventListener('keydown', e => { if (e.key === 'Enter') input.blur(); });
    div.innerHTML = '';
    div.appendChild(input);
    input.focus();
  }

  function calculateAll() {
    ['Fergus', 'Finn'].forEach(cat => {
      const morning = parseFloat(document.getElementById(`${cat.toLowerCase()}MorningWet`).value) || 0;
      const evening = parseFloat(document.getElementById(`${cat.toLowerCase()}EveningWet`).value) || 0;
      const treatCals = cats[cat].treats * treatCalories;

      const totalWet = morning + evening + treatCals;
      const remainingCals = cats[cat].daily - totalWet;
      const dryGramsTotal = remainingCals / dryCalPerGram;
      const dryGramsPerMeal = dryGramsTotal / 2;

      const resultDiv = document.getElementById(`${cat.toLowerCase()}Result`);
      resultDiv.innerHTML = `
        <div><strong>${cat}</strong></div>
        <div>Wet + Treat calories: ${totalWet.toFixed(1)} kcal</div>
        <div>Treats: ${cats[cat].treats} (${treatCals} kcal)</div>
        <div>Dry food total: <strong>${dryGramsTotal.toFixed(1)} g</strong></div>
        <div>Each meal: <strong>${dryGramsPerMeal.toFixed(1)} g</strong></div>
      `;
    });
  }

  function saveData() {
    const data = {
      cats,
      dryCalPerGram,
      treatCalories,
      inputs: {
        fergusMorningWet: document.getElementById('fergusMorningWet').value,
        fergusEveningWet: document.getElementById('fergusEveningWet').value,
        finnMorningWet: document.getElementById('finnMorningWet').value,
        finnEveningWet: document.getElementById('finnEveningWet').value,
        fergusMorningSelect: document.getElementById('fergusMorningSelect').value,
        fergusEveningSelect: document.getElementById('fergusEveningSelect').value,
        finnMorningSelect: document.getElementById('finnMorningSelect').value,
        finnEveningSelect: document.getElementById('finnEveningSelect').value,
      }
    };
    localStorage.setItem('catFoodData', JSON.stringify(data));
  }

  function loadData() {
    const saved = JSON.parse(localStorage.getItem('catFoodData'));
    if (saved) {
      if (saved.cats) {
        for (const key in saved.cats) {
          cats[key] = { ...cats[key], ...saved.cats[key] };
        }
      }
      dryCalPerGram = saved.dryCalPerGram || 4.1;
      treatCalories = saved.treatCalories || 2;
    }
    for (const cat in cats) {
      document.getElementById(`${cat.toLowerCase()}CalInfo`).textContent = `${cats[cat].daily} kcal/day`;
    }
  }

  function restoreInputs() {
    const saved = JSON.parse(localStorage.getItem('catFoodData'));
    if (!saved || !saved.inputs) return;
    for (const [id, val] of Object.entries(saved.inputs)) {
      const el = document.getElementById(id);
      if (el) el.value = val;
    }
  }

  function resetData() {
    if (confirm('Clear all saved data?')) {
      localStorage.removeItem('catFoodData');
      location.reload();
    }
  }

  // Settings modal functions
  function openSettings() {
    document.getElementById('dryCalPerGramInput').value = dryCalPerGram;
    document.getElementById('treatCaloriesInput').value = treatCalories;
    document.getElementById('settingsModal').style.display = 'block';
  }

  function closeSettings() {
    document.getElementById('settingsModal').style.display = 'none';
  }

  function saveSettings() {
    const dryVal = parseFloat(document.getElementById('dryCalPerGramInput').value);
    const treatVal = parseFloat(document.getElementById('treatCaloriesInput').value);

    if (!isNaN(dryVal) && dryVal > 0) dryCalPerGram = dryVal;
    if (!isNaN(treatVal) && treatVal > 0) treatCalories = treatVal;

    saveData();
    calculateAll();
    closeSettings();
  }

  window.onclick = function(event) {
    const modal = document.getElementById('settingsModal');
    if (event.target === modal) modal.style.display = 'none';
  };
</script>
</body>
</html>
